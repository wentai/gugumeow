<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>GuGuMeow</title>
<style>
.axis path,
.axis line {
   fill: none;
   stroke: black;
   shape-rendering: crispEdges;
}
.axis text {
   font-family: sans-serif;
   font-size: 11px;
}
</style>
</head>
<body>
<h1>GuGuMeow~~</h1>
<!-- JavaScript程式區塊 -->
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8">
</script>
<button type="button" onclick="update()">更新</button>
<button type="button" onclick="add()">增加</button>
<button type="button" onclick="sub()">減少</button>
<script>
//增加一個SVG區域，並定義外邊框
var width = 500;
var height = 500;
var svg = d3.select('body')
            .append('svg')
            .attr('width', width)
            .attr('height', height);
//外邊框
var padding = { top:30, right:30, bottom:30, left:30 };
//一組圓心座標，作為散點
var center = [
    [0.5, 0.5], [0.7, 0.8], [0.4, 0.9], [0.11,0.32],[0.88,0.25],
    [0.75,0.12], [0.5, 0.1], [0.2, 0.3], [0.4, 0.1], [0.6, 0.7]
];
//定義比例尺
var xAxisWidth = 300;  //x軸寬度
var yAxisWidth = 300;  //y軸寬度
var xScale = d3.scale.linear()  //x軸比例尺
               .domain([0, 1])
               .range([0, xAxisWidth]);
var yScale = d3.scale.linear()  //y軸比例尺
               .domain([0, 1])
               .range([0, yAxisWidth]);
drawAxis();

function drawCircle(){

   //綁定資料，取得update部分
   var circleUpdate = svg.selectAll('circle')
                         .data(center);  //綁定資料
   //取得enter部分
   var circleEnter = circleUpdate.enter();
   //取得exit部分
   var circleExit = circleUpdate.exit();

   //1.update部分的處理辦法
   //使用過渡的方式，緩緩移動到新座標位置
   circleUpdate.transition()
               .duration(500)
               .attr('cx', function(d){
                  return padding.left + xScale(d[0]);
               })
               .attr('cy', function(d){
                  return height - padding.bottom - yScale(d[1]);
               });

   //2.enter部分的處理辦法
   //插入圓到座標原點，然後再過渡到目標點
   circleEnter.append('circle')
              .attr('fill', 'black')
              .attr('cx', padding.left)
              .attr('cy', height - padding.bottom)
              .attr('r', 7)
              .transition()
              .duration(500)
              .attr('cx', function(d){
                 return padding.left + xScale(d[0]);
              })
              .attr('cy', function(d){
                 console.log(d[1] + " " + yScale(d[1]));
                 return height - padding.bottom - yScale(d[1]);
              });

   //3.exit部分的處理辦法
   //慢慢變成白色，最後刪除
   circleExit.transition()
             .duration(500)
             .attr('fill', 'white')
             .remove();
}

//增加座標軸
function drawAxis(){

   //x軸的產生器
   var xAxis = d3.svg.axis()
                 .scale(xScale)
                 .orient('bottom')
                 .ticks(5)
   //重定義y軸比例尺的值域
   yScale.range([yAxisWidth, 0]);

   //y軸的產生器
   var yAxis = d3.svg.axis()
                 .scale(yScale)
                 .orient('left')
                 .ticks(5);

   //繪製x軸
   svg.append('g')
      .attr('class', 'axis')
      .attr('transform', 'translate(' + padding.left + ',' + (height - padding.bottom + ')'))
      .call(xAxis);

   //繪製y軸
   svg.append('g')
      .attr('class', 'axis')
      .attr('transform', 'translate(' + padding.left + ',' + (height - padding.bottom - yAxisWidth) + ')')
      .call(yAxis);

   //繪製完座標軸後將值域變回去
   yScale.range([0, yAxisWidth]);
}

//更新
function update(){
   for(var i=0; i<center.length; i++){
      center[i][0] = Math.random();
      center[i][1] = Math.random();
   }
   drawCircle();
}

//增加
function add(){
   center.push([Math.random(), Math.random()]);
   drawCircle();
}

//刪除
function sub(){
   center.pop();
   drawCircle();
}
</script>
</body>
</html>
